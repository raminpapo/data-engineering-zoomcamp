# Documentation: producer.py

## File Metadata

- **Path**: `06-streaming/python/json_example/producer.py`
- **Size**: 1,536 bytes
- **Lines**: 44
- **Extension**: `.py`
- **Last Modified**: 2025-11-15T19:46:38.182125

## Original Source

```python
import csv
import json
from typing import List, Dict
from kafka import KafkaProducer
from kafka.errors import KafkaTimeoutError

from ride import Ride
from settings import BOOTSTRAP_SERVERS, INPUT_DATA_PATH, KAFKA_TOPIC


class JsonProducer(KafkaProducer):
    def __init__(self, props: Dict):
        self.producer = KafkaProducer(**props)

    @staticmethod
    def read_records(resource_path: str):
        records = []
        with open(resource_path, 'r') as f:
            reader = csv.reader(f)
            header = next(reader)  # skip the header row
            for row in reader:
                records.append(Ride(arr=row))
        return records

    def publish_rides(self, topic: str, messages: List[Ride]):
        for ride in messages:
            try:
                record = self.producer.send(topic=topic, key=ride.pu_location_id, value=ride)
                print('Record {} successfully produced at offset {}'.format(ride.pu_location_id, record.get().offset))
            except KafkaTimeoutError as e:
                print(e.__str__())


if __name__ == '__main__':
    # Config Should match with the KafkaProducer expectation
    config = {
        'bootstrap_servers': BOOTSTRAP_SERVERS,
        'key_serializer': lambda key: str(key).encode(),
        'value_serializer': lambda x: json.dumps(x.__dict__, default=str).encode('utf-8')
    }
    producer = JsonProducer(props=config)
    rides = producer.read_records(resource_path=INPUT_DATA_PATH)
    producer.publish_rides(topic=KAFKA_TOPIC, messages=rides)

```

## High-Level Overview

Python module containing 3 functions and 1 classes.

## Detailed Analysis

### Functions
- **`__init__(self, props: Dict)`**
- **`read_records(resource_path: str)`**
- **`publish_rides(self, topic: str, messages: List[Ride])`**

### Classes
- **`JsonProducer`**

### Dependencies
- `csv`
- `json`
- `List, Dict`
- `KafkaProducer`
- `KafkaTimeoutError`
- `Ride`
- `BOOTSTRAP_SERVERS, INPUT_DATA_PATH, KAFKA_TOPIC`


## Usage & Examples

*No explicit usage examples found in file.*


## Dependencies & Related Files

### Imported Modules

- `csv`
- `kafka`
- `settings`
- `ride`
- `KafkaTimeoutError`
- `json`
- `Ride`
- `List`
- `typing`
- `BOOTSTRAP_SERVERS`
- `kafka.errors`
- `KafkaProducer`


## Performance & Security Notes

*No specific performance or security issues detected.*


## Testing & Validation

*No test framework detected. Manual testing may be required.*


---
*Generated by Repo Book Generator v1.0.0*
